{"version":3,"file":"VVirtualTable.mjs","names":["VSimpleTable","mixins","convertToUnit","debounce","baseMixins","extend","name","props","chunkSize","type","Number","default","headerHeight","items","Array","rowHeight","data","scrollTop","oldChunk","scrollDebounce","invalidateCache","computed","itemsLength","length","totalHeight","topIndex","Math","floor","chunkIndex","startIndex","max","offsetTop","stopIndex","min","offsetBottom","watch","newValue","oldValue","cachedItems","$refs","table","created","mounted","onScroll","addEventListener","passive","beforeDestroy","removeEventListener","methods","createStyleHeight","height","genBody","genItems","$createElement","style","$scopedSlots","slice","e","target","genTable","ref","staticClass","$slots","genWrapper","render","h","class","classes","top","bottom"],"sources":["../../../src/components/VDataTable/VVirtualTable.ts"],"sourcesContent":["// @ts-nocheck\n/* eslint-disable */\n\nimport './VVirtualTable.sass'\n\n// Components\nimport VSimpleTable from './VSimpleTable'\n\n// Types\nimport { VNode, VNodeChildren } from 'vue'\nimport { PropValidator } from 'vue/types/options'\nimport mixins from '../../util/mixins'\n\n// Utiltiies\nimport { convertToUnit, debounce } from '../../util/helpers'\n\n// Types\nconst baseMixins = mixins(VSimpleTable)\n\ninterface options extends InstanceType<typeof baseMixins> {\n  $refs: {\n    table: HTMLElement\n  }\n  cachedItems: VNodeChildren\n}\n\nexport default baseMixins.extend<options>().extend({\n  name: 'v-virtual-table',\n\n  props: {\n    chunkSize: {\n      type: Number,\n      default: 25,\n    },\n    headerHeight: {\n      type: Number,\n      default: 48,\n    },\n    items: {\n      type: Array,\n      default: () => ([]),\n    } as PropValidator<any[]>,\n    rowHeight: {\n      type: Number,\n      default: 48,\n    },\n  },\n\n  data: () => ({\n    scrollTop: 0,\n    oldChunk: 0,\n    scrollDebounce: null as any,\n    invalidateCache: false,\n  }),\n\n  computed: {\n    itemsLength (): number {\n      return this.items.length\n    },\n    totalHeight (): number {\n      return (this.itemsLength * this.rowHeight) + this.headerHeight\n    },\n    topIndex (): number {\n      return Math.floor(this.scrollTop / this.rowHeight)\n    },\n    chunkIndex (): number {\n      return Math.floor(this.topIndex / this.chunkSize)\n    },\n    startIndex (): number {\n      return Math.max(0, (this.chunkIndex * this.chunkSize) - this.chunkSize)\n    },\n    offsetTop (): number {\n      return Math.max(0, this.startIndex * this.rowHeight)\n    },\n    stopIndex (): number {\n      return Math.min(this.startIndex + (this.chunkSize * 3), this.itemsLength)\n    },\n    offsetBottom (): number {\n      return Math.max(0, (this.itemsLength - this.stopIndex - this.startIndex) * this.rowHeight)\n    },\n  },\n\n  watch: {\n    chunkIndex (newValue, oldValue) {\n      this.oldChunk = oldValue\n    },\n    items () {\n      this.cachedItems = null\n      this.$refs.table.scrollTop = 0\n    },\n  },\n\n  created () {\n    this.cachedItems = null\n  },\n\n  mounted () {\n    this.scrollDebounce = debounce(this.onScroll, 50)\n\n    this.$refs.table.addEventListener('scroll', this.scrollDebounce, { passive: true })\n  },\n\n  beforeDestroy () {\n    this.$refs.table.removeEventListener('scroll', this.scrollDebounce)\n  },\n\n  methods: {\n    createStyleHeight (height: number) {\n      return {\n        height: `${height}px`,\n      }\n    },\n    genBody () {\n      if (this.cachedItems === null || this.chunkIndex !== this.oldChunk) {\n        this.cachedItems = this.genItems()\n        this.oldChunk = this.chunkIndex\n      }\n\n      return this.$createElement('tbody', [\n        this.$createElement('tr', { style: this.createStyleHeight(this.offsetTop) }),\n        this.cachedItems,\n        this.$createElement('tr', { style: this.createStyleHeight(this.offsetBottom) }),\n      ])\n    },\n    genItems () {\n      return this.$scopedSlots.items!({ items: this.items.slice(this.startIndex, this.stopIndex) })\n    },\n    onScroll (e: Event) {\n      const target = e.target as Element\n      this.scrollTop = target.scrollTop\n    },\n    genTable () {\n      return this.$createElement('div', {\n        ref: 'table',\n        staticClass: 'v-virtual-table__table',\n      }, [\n        this.$createElement('table', [\n          this.$slots['body.before'],\n          this.genBody(),\n          this.$slots['body.after'],\n        ]),\n      ])\n    },\n    genWrapper () {\n      return this.$createElement('div', {\n        staticClass: 'v-virtual-table__wrapper',\n        style: {\n          height: convertToUnit(this.height),\n        },\n      }, [\n        this.genTable(),\n      ])\n    },\n  },\n\n  render (h): VNode {\n    return h('div', {\n      staticClass: 'v-data-table v-virtual-table',\n      class: this.classes,\n    }, [\n      this.$slots.top,\n      this.genWrapper(),\n      this.$slots.bottom,\n    ])\n  },\n})\n"],"mappings":"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"}