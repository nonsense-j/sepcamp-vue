{"version":3,"file":"stack.mjs","names":["useToggleScope","computed","inject","onScopeDispose","provide","reactive","readonly","ref","watchEffect","getCurrentInstance","StackSymbol","Symbol","for","globalStack","useStack","isActive","zIndex","vm","parent","undefined","stack","activeChildren","Set","_zIndex","value","lastZIndex","at","push","uid","add","idx","findIndex","v","splice","delete","globalTop","_isTop","setTimeout","localTop","size","stackStyles"],"sources":["../../src/composables/stack.ts"],"sourcesContent":["import { useToggleScope } from '@/composables/toggleScope'\n\nimport { computed, inject, onScopeDispose, provide, reactive, readonly, ref, watchEffect } from 'vue'\nimport { getCurrentInstance } from '@/util'\n\n// Types\nimport type { InjectionKey, Ref } from 'vue'\n\nconst StackSymbol: InjectionKey<StackProvide> = Symbol.for('vuetify:stack')\n\ninterface StackProvide {\n  activeChildren: Set<number>\n}\n\nconst globalStack = reactive<[uid: number, zIndex: number][]>([])\n\nexport function useStack (isActive: Readonly<Ref<boolean>>, zIndex: Readonly<Ref<string | number>>) {\n  const vm = getCurrentInstance('useStack')\n\n  const parent = inject(StackSymbol, undefined)\n  const stack: StackProvide = reactive({\n    activeChildren: new Set<number>(),\n  })\n  provide(StackSymbol, stack)\n\n  const _zIndex = ref(+zIndex.value)\n  useToggleScope(isActive, () => {\n    const lastZIndex = globalStack.at(-1)?.[1]\n    _zIndex.value = lastZIndex ? lastZIndex + 10 : +zIndex.value\n    globalStack.push([vm.uid, _zIndex.value])\n\n    parent?.activeChildren.add(vm.uid)\n\n    onScopeDispose(() => {\n      const idx = globalStack.findIndex(v => v[0] === vm.uid)\n      globalStack.splice(idx, 1)\n\n      parent?.activeChildren.delete(vm.uid)\n    })\n  })\n\n  const globalTop = ref(true)\n  watchEffect(() => {\n    const _isTop = globalStack.at(-1)?.[0] === vm.uid\n    setTimeout(() => globalTop.value = _isTop)\n  })\n\n  const localTop = computed(() => !stack.activeChildren.size)\n\n  return {\n    globalTop: readonly(globalTop),\n    localTop,\n    stackStyles: computed(() => ({ zIndex: _zIndex.value })),\n  }\n}\n"],"mappings":"SAASA,cAAc;AAEvB,SAASC,QAAQ,EAAEC,MAAM,EAAEC,cAAc,EAAEC,OAAO,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,WAAW,QAAQ,KAAK;AAAA,SAC5FC,kBAAkB,6BAE3B;AAGA,MAAMC,WAAuC,GAAGC,MAAM,CAACC,GAAG,CAAC,eAAe,CAAC;AAM3E,MAAMC,WAAW,GAAGR,QAAQ,CAAkC,EAAE,CAAC;AAEjE,OAAO,SAASS,QAAQ,CAAEC,QAAgC,EAAEC,MAAsC,EAAE;EAClG,MAAMC,EAAE,GAAGR,kBAAkB,CAAC,UAAU,CAAC;EAEzC,MAAMS,MAAM,GAAGhB,MAAM,CAACQ,WAAW,EAAES,SAAS,CAAC;EAC7C,MAAMC,KAAmB,GAAGf,QAAQ,CAAC;IACnCgB,cAAc,EAAE,IAAIC,GAAG;EACzB,CAAC,CAAC;EACFlB,OAAO,CAACM,WAAW,EAAEU,KAAK,CAAC;EAE3B,MAAMG,OAAO,GAAGhB,GAAG,CAAC,CAACS,MAAM,CAACQ,KAAK,CAAC;EAClCxB,cAAc,CAACe,QAAQ,EAAE,MAAM;IAAA;IAC7B,MAAMU,UAAU,sBAAGZ,WAAW,CAACa,EAAE,CAAC,CAAC,CAAC,CAAC,qBAAlB,gBAAqB,CAAC,CAAC;IAC1CH,OAAO,CAACC,KAAK,GAAGC,UAAU,GAAGA,UAAU,GAAG,EAAE,GAAG,CAACT,MAAM,CAACQ,KAAK;IAC5DX,WAAW,CAACc,IAAI,CAAC,CAACV,EAAE,CAACW,GAAG,EAAEL,OAAO,CAACC,KAAK,CAAC,CAAC;IAEzCN,MAAM,oBAANA,MAAM,CAAEG,cAAc,CAACQ,GAAG,CAACZ,EAAE,CAACW,GAAG,CAAC;IAElCzB,cAAc,CAAC,MAAM;MACnB,MAAM2B,GAAG,GAAGjB,WAAW,CAACkB,SAAS,CAACC,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAKf,EAAE,CAACW,GAAG,CAAC;MACvDf,WAAW,CAACoB,MAAM,CAACH,GAAG,EAAE,CAAC,CAAC;MAE1BZ,MAAM,oBAANA,MAAM,CAAEG,cAAc,CAACa,MAAM,CAACjB,EAAE,CAACW,GAAG,CAAC;IACvC,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,MAAMO,SAAS,GAAG5B,GAAG,CAAC,IAAI,CAAC;EAC3BC,WAAW,CAAC,MAAM;IAAA;IAChB,MAAM4B,MAAM,GAAG,qBAAAvB,WAAW,CAACa,EAAE,CAAC,CAAC,CAAC,CAAC,qBAAlB,iBAAqB,CAAC,CAAC,MAAKT,EAAE,CAACW,GAAG;IACjDS,UAAU,CAAC,MAAMF,SAAS,CAACX,KAAK,GAAGY,MAAM,CAAC;EAC5C,CAAC,CAAC;EAEF,MAAME,QAAQ,GAAGrC,QAAQ,CAAC,MAAM,CAACmB,KAAK,CAACC,cAAc,CAACkB,IAAI,CAAC;EAE3D,OAAO;IACLJ,SAAS,EAAE7B,QAAQ,CAAC6B,SAAS,CAAC;IAC9BG,QAAQ;IACRE,WAAW,EAAEvC,QAAQ,CAAC,OAAO;MAAEe,MAAM,EAAEO,OAAO,CAACC;IAAM,CAAC,CAAC;EACzD,CAAC;AACH"}